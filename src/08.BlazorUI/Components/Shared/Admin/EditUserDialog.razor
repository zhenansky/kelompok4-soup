@using MyApp.BlazorUI.Services
<MudDialog>
  <TitleContent>
    <MudText Typo="Typo.h6">Edit User</MudText>
  </TitleContent>

  <DialogContent>
    <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">
      <MudPaper Elevation="0" Class="d-flex flex-column gap-6">

        <MudTextField T="string" @bind-Value="User.Name" Placeholder="Name" Variant="Variant.Outlined" Required="true"
          RequiredError="Name is required!" For="@(() => User.Name)" Style="height: 2rem;" />

        <MudTextField T="string" @bind-Value="User.Email" Placeholder="Email" Variant="Variant.Outlined"
          InputType="InputType.Email" Required="true" RequiredError="Email is required!" Validation="ValidateEmail"
          For="@(() => User.Email)" Style="height: 2rem;" />

        <MudText>Role:</MudText>
        <MudRadioGroup @bind-Value="User.Role" required For="@(() => User.Role)">
          <MudRadio Value="@UserRole.Admin" Color="Color.Warning">Admin</MudRadio>
          <MudRadio Value="@UserRole.User" Color="Color.Warning">User</MudRadio>
        </MudRadioGroup>

        <MudText>Status:</MudText>
        <MudRadioGroup @bind-Value="User.Status" required For="@(() => User.Status)">
          <MudRadio Value="@UserStatus.Active" Color="Color.Success">Active</MudRadio>
          <MudRadio Value="@UserStatus.Inactive" Color="Color.Error">Inactive</MudRadio>
        </MudRadioGroup>

        @if (!string.IsNullOrEmpty(userError))
        {
          <MudText Color="Color.Error">@userError</MudText>
        }

      </MudPaper>
    </MudForm>
  </DialogContent>

  <DialogActions>
    <MudButton OnClick="Cancel" Variant="Variant.Outlined" Class="rounded-lg">Cancel</MudButton>
    <MudButton OnClick="Submit" Variant="Variant.Filled" Class="rounded-lg"
      Style="background-color:green; color: white;">Submit</MudButton>
  </DialogActions>
</MudDialog>

@code {
  [CascadingParameter] private IMudDialogInstance MudDialog { get; set; }
  [Parameter] public UserModel User { get; set; } = default!;
  [Inject] private UserService UserService { get; set; }

  private bool success;
  private string[] errors = Array.Empty<string>();
  private MudForm? form;
  private string userError = string.Empty;

  private void Cancel() => MudDialog.Cancel();

  private async Task Submit()
  {
    form?.Validate();
    if (!success) return;

    try
    {
      bool result = await UserService.UpdateUserAsync(User);
      if (result)
      {
        MudDialog.Close(DialogResult.Ok(true));
      }
      else
      {
        userError = "Gagal memperbarui user!";
      }
    }
    catch (Exception ex)
    {
      userError = $"Error: {ex.Message}";
    }
  }

  private string ValidateEmail(string value)
  {
    if (string.IsNullOrWhiteSpace(value))
      return "Email is required!";
    if (!System.Text.RegularExpressions.Regex.IsMatch(value, @"^[^@\s]+@[^@\s]+\.[^@\s]+$"))
      return "Invalid email format!";
    return string.Empty;
  }
}